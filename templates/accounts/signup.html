{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}Register - Glance Job Fair{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="text-center mb-4">
        <img src="{% static 'img/home/logo.svg' %}" alt="Glance Logo" class="mb-3" style="max-width: 150px;">
        <h2>Create Your Account</h2>
        <p class="text-muted">Join our community and start your journey</p>
    </div>

    <form method="post" novalidate enctype="multipart/form-data">
        {% csrf_token %}

        <!-- User Information -->
        <div class="mb-4">
            <h4 class="mb-3">Basic Information</h4>
            <div class="mb-3">
                <label for="username" class="form-label">
                    <i class="fas fa-user me-2"></i>Username
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-user"></i>
                    </span>
                    <input type="text" class="form-control" id="username" name="username" required
                        placeholder="Choose a username" maxlength="50">
                </div>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">
                    <i class="fas fa-envelope me-2"></i>Email
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-envelope"></i>
                    </span>
                    <input type="email" class="form-control" id="email" name="email" required
                        placeholder="Enter your email" maxlength="50">
                </div>
            </div>

            <div class="mb-3">
                <label for="password1" class="form-label">
                    <i class="fas fa-lock me-2"></i>Password
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-key"></i>
                    </span>
                    <input type="password" class="form-control" id="password1" name="password1" required
                        placeholder="Create a password" minlength="8" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}">
                    <button class="btn btn-outline-secondary" type="button" id="togglePassword1">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="form-text">
                    <i class="fas fa-info-circle me-1"></i>
                    Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase
                    letter, and one number.
                </div>
            </div>

            <div class="mb-3">
                <label for="password2" class="form-label">
                    <i class="fas fa-lock me-2"></i>Confirm Password
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-key"></i>
                    </span>
                    <input type="password" class="form-control" id="password2" name="password2" required
                        placeholder="Confirm your password" minlength="8">
                    <button class="btn btn-outline-secondary" type="button" id="togglePassword2">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Profile Information -->
        <div class="mb-4">
            <h4 class="mb-3">Profile Information</h4>
            <div class="mb-3">
                <label for="phone" class="form-label">
                    <i class="fas fa-phone me-2"></i>Phone Number
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-phone"></i>
                    </span>
                    <input type="tel" class="form-control" id="phone" name="phone"
                        placeholder="Enter your phone number">
                </div>
            </div>

            <div class="mb-3">
                <label for="whatsapp" class="form-label">
                    <i class="fab fa-whatsapp me-2"></i>WhatsApp Number
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fab fa-whatsapp"></i>
                    </span>
                    <input type="tel" class="form-control" id="whatsapp" name="whatsapp"
                        placeholder="Enter your WhatsApp number">
                </div>
            </div>

            <div class="mb-3">
                <label for="location" class="form-label">
                    <i class="fas fa-map-marker-alt me-2"></i>Location
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-map-marker-alt"></i>
                    </span>
                    <input type="text" class="form-control" id="location" name="location"
                        placeholder="Enter your location">
                </div>
            </div>
        </div>

        <!-- Role-specific fields -->
        <div id="student-fields" class="role-specific-fields">
            <h4 class="mb-3">Student Information</h4>

            <div class="mb-3">
                <label for="gender" class="form-label">
                    <i class="fas fa-venus-mars me-2"></i>Gender
                </label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-venus-mars"></i>
                    </span>
                    <select class="form-select" id="gender" name="gender" required>
                        <option value="">Select gender</option>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                        <option value="O">Other</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary" id="signupBtn">
                <i class="fas fa-user-plus me-2"></i>Create Account
            </button>
        </div>
    </form>

    <div class="auth-links">
        <p class="mb-0">Already have an account? <a href="{% url 'login' %}">Sign in here</a></p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const roleSelect = document.getElementById('role');
        const studentFields = document.getElementById('student-fields');
        const recruiterFields = document.getElementById('recruiter-fields');
        const form = document.querySelector('form');
        const signupBtn = document.getElementById('signupBtn');
        const togglePassword1 = document.getElementById('togglePassword1');
        const togglePassword2 = document.getElementById('togglePassword2');
        const password1 = document.getElementById('password1');
        const password2 = document.getElementById('password2');
        const profilePicture = document.getElementById('profile_picture');
        const companyLogo = document.getElementById('company_logo');
        const fileName = document.getElementById('file-name');
        const logoName = document.getElementById('logo-name');
        const usernameInput = document.getElementById('username');
        const emailInput = document.getElementById('email');

        
        // Validate passwords match
        function validatePasswords() {
            if (password1.value !== password2.value) {
                password2.setCustomValidity("Passwords don't match");
            } else {
                password2.setCustomValidity('');
            }
        }

        password1.addEventListener('change', validatePasswords);
        password2.addEventListener('keyup', validatePasswords);

        // Check password requirements
        password1.addEventListener('keyup', function () {
            const hasUpperCase = /[A-Z]/.test(this.value);
            const hasLowerCase = /[a-z]/.test(this.value);
            const hasNumber = /\d/.test(this.value);
            const isLongEnough = this.value.length >= 8;

            if (!hasUpperCase || !hasLowerCase || !hasNumber || !isLongEnough) {
                this.setCustomValidity('Password must contain at least 8 characters, including uppercase, lowercase, and number');
            } else {
                this.setCustomValidity('');
            }
        });

        // Toggle password visibility
        function togglePasswordVisibility(toggleBtn, passwordInput) {
            toggleBtn.addEventListener('click', function () {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.querySelector('i').classList.toggle('fa-eye');
                this.querySelector('i').classList.toggle('fa-eye-slash');
            });
        }

        togglePasswordVisibility(togglePassword1, password1);
        togglePasswordVisibility(togglePassword2, password2);

        handleFileUpload(profilePicture, fileName);
        handleFileUpload(companyLogo, logoName);
    });
</script>
{% endblock %}